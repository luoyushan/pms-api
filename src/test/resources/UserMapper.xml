<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pms.api.sys.user.UserMapper" >
  <sql id="userColumns" >
    a.id,
    a.name,
    a.title,
    a.remarks,
    a.create_by as "createBy.username",
    a.create_date as "createDate" ,
    a.update_by = "updateBy.username",
    a.update_date as "updateDate",
  </sql>

  <sql id="userJoins">
    join sys_user su on su.id = a.create_by
  </sql>

  <select id="get" resultType="com.pms.api.sys.user.User">
    SELECT
      <include refid="userColumns"/>
    FROM sys_user a
    WHERE a.id = #{id}
  </select>

  <select id="findList" resultType="com.pms.api.sys.user.User" >
    SELECT
    <include refid="userColumns" />
    FROM sys_user a
    <where>
      <if test="delFlag != null and delFlag != ''">
        AND a.del_flag = #{delFlag}
      </if>
      <if test="delFlag == null or delFlag == ''">
        AND a.del_flag = #{DEL_FLAG_NORMAL}
      </if>
      <if test="name != null and name != ''">
        AND a.name LIKE '%'||#{name}||'%'
      </if>
    </where>
  </select>

  <insert id="insert">
    INSERT INTO sys_user(
    id,
    name,
    title,
    remarks,
    create_by,
    create_date,
    update_by,
    update_date,
    del_flag
    ) VALUES (
    #{id},
    #{name},
    #{title},
    #{remarks},
    #{createBy.username},
    #{createDate},
    #{updateBy.username},
    #{updateDate},
    #{delFlag}
    )
  </insert>

  <update id="update">
    UPDATE sys_user SET
    name = #{name},
    title #{title},
    remarks = #{remarks},
    update_by = #{updateBy.username},
    update_date = #{updateDate}
    WHERE id = #{id}
  </update>

  <update id="delete">
    UPDATE sys_user SET
    del_flag = #{DEL_FLAG_DELETE}
    WHERE id = #{id}
  </update>

  <select id="getUserByUsername" resultType="com.pms.api.sys.user.User">
    SELECT
    <include refid="userColumns"/>
    FROM sys_user a
    WHERE a.username = #{username}
  </select>
</mapper>
